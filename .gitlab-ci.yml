image: registry.esss.lu.se/afonsomukai/docker-registry:1.0.0

stages:
  - deps
  - check
  - test

requirements:
  tags:
    - docker
  stage: deps
  script:
    - scl enable rh-python38 -- python -m pip install --user -r requirements.txt

flake8:
  tags:
    - docker
  stage: check
  script:
    - scl enable rh-python38 -- python -m flake8

black:
  tags:
    - docker
  stage: check
  script:
    - scl enable rh-python38 -- python -m black --check .

mypy:
  tags:
    - docker
  stage: check
  script:
    - scl enable rh-python38 -- python -m mypy .

test:
  tags:
    - docker
  stage: test
  script:
    - scl enable rh-python38 -- python -m pytest
